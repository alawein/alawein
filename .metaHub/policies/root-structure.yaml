# Root Directory Structure Policy
# Defines what files and directories are allowed at the repository root level
# Enforced by structure_validator.py and GitHub Actions

version: "3.3"
last_updated: "2025-12-06"
updated_by: "repository-consolidation-migration"

# =============================================================================
# ALLOWED ROOT-LEVEL FILES
# =============================================================================
allowed_files:
  # Standard Documentation (required)
  required:
    - name: "README.md"
      purpose: "Repository overview and getting started guide"
    - name: "LICENSE"
      purpose: "Open source license (MIT)"
    - name: "SECURITY.md"
      purpose: "Security policy and vulnerability reporting"
    - name: "CLAUDE.md"
      purpose: "Claude Code AI assistant instructions"

  # Standard Documentation (recommended)
  recommended:
    - name: "CONTRIBUTING.md"
      purpose: "Contribution guidelines"
    - name: "GOVERNANCE.md"
      purpose: "Portfolio governance documentation"
    - name: "CHANGELOG.md"
      purpose: "Version history and changes"
    - name: "CODE_OF_CONDUCT.md"
      purpose: "Community guidelines"

  # Configuration Files (allowed)
  configuration:
    - name: ".gitignore"
      purpose: "Git ignore patterns"
    - name: ".gitattributes"
      purpose: "Git attributes for line endings, LFS"
    - name: ".dockerignore"
      purpose: "Docker build ignore patterns"
    - name: ".pre-commit-config.yaml"
      purpose: "Pre-commit hook configuration"
    - name: ".yamllint.yaml"
      purpose: "YAML linting rules"
    - name: ".editorconfig"
      purpose: "Editor configuration"
    - name: "mkdocs.yaml"
      purpose: "MkDocs documentation site configuration"
    - name: "pyproject.toml"
      purpose: "Python project configuration"
    - name: "package.json"
      purpose: "Node.js dependencies and scripts"
    - name: "package-lock.json"
      purpose: "Node.js dependency lock file"
    - name: "tsconfig.json"
      purpose: "TypeScript compiler configuration"
    - name: "eslint.config.js"
      purpose: "ESLint v9 flat configuration"
    - name: "vitest.config.ts"
      purpose: "Vitest test runner configuration"
    - name: ".prettierrc"
      purpose: "Prettier code formatter configuration"
    - name: ".prettierignore"
      purpose: "Prettier ignore patterns"
    - name: ".eslintignore"
      purpose: "ESLint ignore patterns"
    - name: ".env.example"
      purpose: "Environment variables template (no secrets)"

# =============================================================================
# ALLOWED ROOT-LEVEL DIRECTORIES
# =============================================================================
allowed_directories:
  # Core Governance (required)
  required:
    - name: ".metaHub"
      purpose: "Central governance system - scripts, templates, policies"
    - name: ".github"
      purpose: "GitHub-specific configs, workflows, issue templates"
    - name: "projects"
      purpose: "Project registry documenting all 85+ projects"
    - name: "business"
      purpose: "LLC & business planning documentation"

  # AI & Orchestration (required)
  ai_infrastructure:
    - name: ".ai"
      purpose: "Consolidated AI assistant configurations (canonical location)"
    - name: ".ORCHEX"
      purpose: "ORCHEX agent framework runtime state and metrics"
    - name: ".claude"
      purpose: "Claude Code specific configurations"

  # Documentation (recommended)
  recommended:
    - name: "docs"
      purpose: "MkDocs documentation source files"

  # Development (required for this repo)
  development:
    - name: "tests"
      purpose: "Governance system unit tests (Python and TypeScript)"
    - name: "tools"
      purpose: "Unified toolkit - AI orchestration, governance, DevOps, security (includes bin/, scripts/)"
    - name: "src"
      purpose: "Service implementations and core business logic (placeholder for future services)"

  # Automation Systems
  automation:
    - name: "automation"
      purpose: "Unified automation system (Python agents, workflows, orchestration)"

  # Supporting Directories
  supporting:
    - name: "demo"
      purpose: "Demo dashboards, scenarios, test repos, examples"
    - name: "config"
      purpose: "Centralized configuration files (TypeScript, linting, CI/CD)"

  # LLC Organization (canonical location for all projects)
  organization:
    - name: "organizations"
      purpose: "Canonical location for all LLC projects (Alawein Technologies, Live It Iconic, REPZ)"

  # Tool Configuration (allowed, should be hidden)
  tooling:
    - name: ".husky"
      purpose: "Git hooks (husky)"
    - name: ".vscode"
      purpose: "VS Code workspace settings"
    - name: ".allstar"
      purpose: "GitHub Allstar security configuration"

  # Cache & Build (auto-generated, gitignored)
  cache:
    - name: ".mypy_cache"
      purpose: "MyPy type checking cache"
    - name: ".pytest_cache"
      purpose: "Pytest cache"
    - name: ".ruff_cache"
      purpose: "Ruff linter cache"
    - name: "__pycache__"
      purpose: "Python bytecode cache"
    - name: "node_modules"
      purpose: "Node.js dependencies"
    - name: "dist"
      purpose: "Build output"
    - name: ".archive"
      purpose: "Archived files and historical data (includes organizations/)"
    - name: ".personal"
      purpose: "Personal projects (portfolio, drmalawein, rounaq)"

# =============================================================================
# FORBIDDEN AT ROOT
# =============================================================================
forbidden:
  file_patterns:
    - "*.pdf"           # Move to docs/reports/
    - "*.doc*"          # Move to docs/
    - "*.xls*"          # Move to docs/
    - "*.ppt*"          # Move to docs/
    - "*.zip"           # Should not be in repo
    - "*.tar.gz"        # Should not be in repo
    - "*.code-workspace" # Move to .vscode/ or gitignore
    - "*-report.json"   # Should be gitignored (generated)
    - "*-results.json"  # Should be gitignored (generated)
    - "temp_*.js"       # Temporary files - delete immediately
    - "temp_*.ts"       # Temporary files - delete immediately

  directory_patterns:
    - "temp-*"          # Temporary directories
    - "new-*"           # Staging directories (should be gitignored)
    - "old*"            # Archived directories
    - "*}/"             # Malformed directory names (stray braces)
    - "-*"              # Directories starting with dash (invalid)

  specific_items:
    - "Thumbs.db"       # Windows thumbnail cache
    - ".DS_Store"       # macOS metadata
    - "*.log"           # Log files
    - ".env"            # Environment files (secrets)
    - ".env.*"          # Environment variations
    - "nul"             # Windows null device / garbage files
    # Legacy AI directories (migrated to .ai/)
    - ".cursor"         # Use .ai/cursor/
    - ".cline"          # Use .ai/cline/
    - ".amazonq"        # Use .ai/amazonq/
    - ".continue"       # Use .ai/continue/
    - ".codex"          # Use .ai/codex/
    - ".gemini"         # Use .ai/gemini/
    - ".kilocode"       # Use .ai/kilocode/
    - ".trae"           # Use .ai/trae/
    - ".blackbox"       # Use .ai/blackbox/
    - ".augment"        # Use .ai/augment/
    - ".aider"          # Use .ai/aider/
    - ".windsurf"       # Use .ai/windsurf/
    - ".copilot"        # Use .ai/copilot/
    # Legacy AI rule files (migrated to .ai/rules/)
    - ".cursorrules"    # Use .ai/rules/cursor.rules
    - ".windsurfrules"  # Use .ai/rules/windsurf.rules
    - ".clinerules"     # Use .ai/rules/cline.rules
    - ".augmentrules"   # Use .ai/rules/augment.rules
    - ".kilorules"      # Use .ai/rules/kilo.rules
    # Legacy unified configs (migrated to .ai/)
    - ".ai-settings.yaml"  # Use .ai/settings.yaml
    - ".ai-context.md"     # Use .ai/context.md
    - ".aider.conf.yml"    # Use .ai/aider/config.yml
    # Report files (should be in docs/ or .archive/)
    - "KILO-*.md"
    - "AUDIT_SUMMARY.md"
    - "COMMIT_PLAN.md"
    - "TODO-REPORT.txt"
    - "REPOSITORY_AUDIT_*.md"

# =============================================================================
# MIGRATION RULES
# =============================================================================
migration:
  # Files to move
  relocate:
    "*.pdf": "docs/reports/"
    "*.code-workspace": ".vscode/"
    "KILO-*.md": ".archive/reports/"
    "*_AUDIT*.md": ".archive/reports/"
    "*_REPORT*.txt": ".archive/reports/"

  # Files to add to .gitignore
  gitignore:
    - "*-report.json"
    - "*-results.json"
    - "temp-*/"
    - "new-*/"
    - "temp_*.js"
    - "temp_*.ts"

  # Directories to review
  review:
    - "Check all new directories have README.md"
    - "Verify no duplicate utilities exist"
    - "Ensure all AI configs are in .ai/"

# =============================================================================
# ENFORCEMENT
# =============================================================================
enforcement:
  level: "error"  # warning | error - STRICT enforcement enabled

  actions:
    on_forbidden_file: "error"
    on_forbidden_dir: "error"
    on_missing_required: "error"
    on_missing_readme: "warning"

  exceptions:
    # Files that may temporarily exist during CI/CD
    ci_exceptions:
      - "coverage.xml"
      - "junit.xml"
      - ".coverage"

    # Build artifacts that may exist temporarily
    build_exceptions:
      - "*.tsbuildinfo"

# =============================================================================
# VALIDATION SCRIPT
# =============================================================================
validation:
  script: ".metaHub/scripts/compliance/structure_validator.py"
  workflow: ".github/workflows/structure-validation.yml"
  pre_commit_hook: true
