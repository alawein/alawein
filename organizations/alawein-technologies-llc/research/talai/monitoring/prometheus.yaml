# TalAI Turing Challenge - Prometheus Configuration
# Metrics collection and monitoring

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'talair-production'
    environment: 'production'

# Alertmanager configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Scrape configurations
scrape_configs:
  # ========================================================================
  # Prometheus self-monitoring
  # ========================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ========================================================================
  # TalAI API Server
  # ========================================================================
  - job_name: 'talair-api'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['talair-api:8000']
        labels:
          service: 'talair-api'
          component: 'backend'

  # ========================================================================
  # Redis Cache
  # ========================================================================
  - job_name: 'redis'
    scrape_interval: 15s
    static_configs:
      - targets: ['redis:6379']
        labels:
          service: 'redis'
          component: 'cache'

  # ========================================================================
  # Nginx Reverse Proxy
  # ========================================================================
  - job_name: 'nginx'
    scrape_interval: 15s
    static_configs:
      - targets: ['nginx:9113']  # Requires nginx-prometheus-exporter
        labels:
          service: 'nginx'
          component: 'proxy'

# ========================================================================
# Recording Rules
# ========================================================================
rule_files:
  # - '/etc/prometheus/rules/*.yml'

# Example recording rules:
# groups:
#   - name: talair_api_rules
#     interval: 30s
#     rules:
#       - record: job:talair_api_request_duration_seconds:rate5m
#         expr: rate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])
#
#       - record: job:talair_api_error_rate:rate5m
#         expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m])
