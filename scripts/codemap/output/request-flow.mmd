sequenceDiagram
    participant C as Component
    participant RQ as React Query
    participant API as ApiService
    participant EF as Edge Function
    participant DB as Database

    C->>RQ: useQuery(['data'])
    RQ->>API: get('/endpoint')
    API->>API: Add Auth Headers
    API->>API: Add CSRF Token

    loop Retry Logic
        API->>EF: HTTP Request
        alt Success
            EF->>DB: Query with RLS
            DB-->>EF: Results
            EF-->>API: 200 OK
        else Retryable Error
            EF-->>API: 5xx Error
            API->>API: Wait (exponential backoff)
        end
    end

    API-->>RQ: Response
    RQ->>RQ: Update Cache
    RQ-->>C: Data
